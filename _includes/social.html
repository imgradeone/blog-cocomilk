<div class="social">
  <h2>Join the Discussion or Spread the Idea</h2>

  {% if page.twitter or page.github or page.bilibili or page.afdian or page.weibo or page.odysee %}
    <div class="official">
      <h3>Post and Comments</h3>

      {% if page.twitter %}
        <a
          href="{{ page.twitter }}"
          rel="noreferrer nofollow noopener"
          target="_blank"
          title="Twitter"
          onclick="plausible('Social: Twitter')"
        >
          <img src="{{ '/images/twitter.svg' | prepend: site.baseurl }}" alt="Twitter" />
        </a>
      {% endif %}

      {% if page.github %}
        <a
          href="{{ page.github }}"
          rel="noreferrer nofollow noopener"
          target="_blank"
          title="GitHub"
          onclick="plausible('Social: GitHub')"
        >
          <img src="{{ '/images/github.svg' | prepend: site.baseurl }}" alt="GitHub" />
        </a>
      {% endif %}

      {% if page.bilibili %}
        <a
          href="{{ page.bilibili }}"
          rel="noreferrer nofollow noopener"
          target="_blank"
          title="bilibili"
          onclick="plausible('Social: bilibili')"
        >
          <img src="{{ '/images/bilibili.svg' | prepend: site.baseurl }}" alt="Facebook" />
        </a>
      {% endif %}

      {% if page.afdian %}
        <a
          href="{{ page.afdian }}"
          rel="noreferrer nofollow noopener"
          target="_blank"
          title="Afdian"
          onclick="plausible('Social: Afdian')"
        >
          <img src="{{ '/images/afdian.svg' | prepend: site.baseurl }}" alt="Afdian" />
        </a>
      {% endif %}

      {% if page.odysee %}
        <a
          href="{{ page.odysee }}"
          rel="noreferrer nofollow noopener"
          target="_blank"
          title="Weibo"
          onclick="plausible('Social: Odysee')"
        >
          <img src="{{ '/images/odysee.svg' | prepend: site.baseurl }}" alt="Odysee" />
        </a>
      {% endif %}

      {% if page.weibo %}
        <a
          href="{{ page.weibo }}"
          rel="noreferrer nofollow noopener"
          target="_blank"
          title="Weibo"
          onclick="plausible('Social: Weibo')"
        >
          <img src="{{ '/images/weibo.png' | prepend: site.baseurl }}" alt="Weibo" />
        </a>
      {% endif %}
    </div>
  {% endif %}

  <div class="share">
    <h3>Share</h3>
    {% assign share-url = page.url | prepend: site.baseurl | prepend: site.url %}

    <a
      href="https://twitter.com/intent/tweet?text={{ page.title }}&url={{ share-url }}&via={{ site.twitter }}&original_referer={{ share-url }}"
      rel="noreferrer nofollow noopener"
      target="_blank"
      title="Twitter"
      onclick="plausible('Share: Twitter')"
    >
      <img src="{{ '/images/twitter.svg' | prepend: site.baseurl }}" alt="Twitter" />
    </a>

    <a
      href="http://www.reddit.com/submit?title={{ page.title }}&url={{ share-url }}"
      rel="noreferrer nofollow noopener"
      target="_blank"
      title="Reddit"
      onclick="plausible('Share: Reddit')"
    >
      <img src="{{ '/images/reddit.svg' | prepend: site.baseurl }}" alt="Reddit" />
    </a>

    <a
      href="https://www.facebook.com/sharer/sharer.php?u={{ share-url }}"
      rel="noreferrer nofollow noopener"
      target="_blank"
      title="Facebook"
      onclick="plausible('Share: Facebook')"
    >
      <img src="{{ '/images/facebook.svg' | prepend: site.baseurl }}" alt="Facebook" />
    </a>

    <a
      href="https://telegram.me/share/url?text={{ page.title }}&url={{ share-url }}"
      rel="noreferrer nofollow noopener"
      target="_blank"
      title="Telegram"
      onclick="plausible('Share: Telegram')"
    >
      <img src="{{ '/images/telegram.svg' | prepend: site.baseurl }}" alt="Telegram" />
    </a>

    <!-- <a
      href="https://service.weibo.com/share/share.php?title={{ page.title }}&url={{ share-url }}"
      rel="noreferrer nofollow noopener"
      target="_blank"
      title="Weibo"
      onclick="plausible('Share: Weibo')"
    >
      <img src="{{ '/images/weibo.png' | prepend: site.baseurl }}" alt="Weibo" />
    </a> -->

    <a
      href="{{ page.url | prepend: site.baseurl | prepend: site.url }}"
      title="Permalink"
      onclick="return share()"
    >
      <img src="{{ '/images/edit-copy-32.svg' | prepend: site.baseurl }}" alt="Permalink" />
    </a>
  </div>
</div>

<script>
function share() {
  plausible('Share: Permalink');

  if (navigator.share) {
    navigator.share({
      title: "{{ page.title }}",
      text: "{{ page.description }}",
      url: "{{ page.url | prepend: site.baseurl | prepend: site.url }}",
    })
    .catch((error) => console.log("Error sharing", error));

    return false;
  } else {
    console.log("Sharing not supported; falling back to link");
    return true;
  }
}
</script>
